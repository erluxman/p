# AI Agent Rules (.cursorrules)

**Purpose**: Instructions for AI agents (including Auto) working on this project.

---

## 1. Tone & Communication

### Before Coding

- **Always ask clarifying questions** before writing code
- **Never guess** requirements or implementation details
- **Confirm assumptions** explicitly

### During Development

- **Explain decisions** when choosing between alternatives
- **Flag potential issues** early (performance, security, maintainability)
- **Suggest improvements** if you see better patterns

### After Completion

- **Summarize changes** clearly
- **Highlight breaking changes** if any
- **Note follow-up tasks** if needed

---

## 2. Technology Stack

### Frontend

- **Flutter**: Dart 3.0+, null safety enabled

  - State: Riverpod (primary), BLoC (if needed)
  - Navigation: go_router
  - HTTP: dio or http
  - Local Storage: shared_preferences, sqflite (if needed)

- **React Native**: TypeScript, React 18+

  - State: Zustand or Redux Toolkit
  - Navigation: React Navigation
  - HTTP: axios or fetch
  - Local Storage: AsyncStorage, SQLite (if needed)

- **React Web**: TypeScript, React 18+
  - State: Zustand or Redux Toolkit
  - Routing: React Router
  - HTTP: axios or fetch
  - Build: Vite

### Backend

- **Firebase Functions**: TypeScript, Node.js 18+

  - Functions Framework
  - Firebase Admin SDK

- **Node.js**: TypeScript, Node.js 18+

  - Framework: Express or Fastify
  - Validation: Zod or Joi
  - Database: Prisma ORM (if using PostgreSQL)

- **Spring Boot**: Java 17+ or Kotlin
  - Spring Web, Spring Data JPA
  - Validation: Jakarta Validation

### Authentication

- **Provider**: Firebase Authentication
- **All platforms**: Use Firebase SDK
- **Backends**: Verify tokens via Firebase Admin SDK

### Database

- **Primary**: Firebase Firestore
- **Secondary**: PostgreSQL (if needed)
- **Cache**: Redis (if needed)

---

## 3. Negative Constraints (NEVER DO THESE)

### 1. Never Put Business Logic in UI Components

```dart
// ❌ BAD
class TodoListWidget extends StatelessWidget {
  Widget build(BuildContext context) {
    // Business logic here
    if (todo.priority > 5) { ... }
  }
}

// ✅ GOOD
class TodoListWidget extends StatelessWidget {
  Widget build(BuildContext context) {
    final todos = ref.watch(todoUseCaseProvider);
    return ListView(...);
  }
}
```

### 2. Never Leave Hardcoded Strings/URLs

```dart
// ❌ BAD
final url = 'https://api.example.com/todos';

// ✅ GOOD
final url = AppConfig.apiBaseUrl + '/todos';
// Or use environment variables
```

### 3. Never Import Infrastructure into Domain

```dart
// ❌ BAD (in core/domain/entities/todo_entity.dart)
import 'package:firebase_firestore/firebase_firestore.dart';

// ✅ GOOD
// Domain entities have zero external dependencies
```

### 4. Never Skip Error Handling

```dart
// ❌ BAD
final result = await api.getTodos();

// ✅ GOOD
try {
  final result = await api.getTodos();
} on NetworkException catch (e) {
  // Handle network error
} on ServerException catch (e) {
  // Handle server error
} catch (e) {
  // Handle unexpected error
}
```

### 5. Never Write Redundant Comments

```dart
// ❌ BAD - Redundant comments
class TodoRepository {
  /// The repository for persisting todos.
  final TodoRepository _repository;

  /// Creates a new [TodoRepository] instance.
  TodoRepository(this._repository);

  /// Adds a todo to the in-memory list.
  _todos.add(todo);
}

// ✅ GOOD - Only comment when code is non-obvious
class TodoRepository {
  final TodoRepository _repository;

  TodoRepository(this._repository);

  // Lazy-load todos on first access to avoid blocking initialization
  Future<void> _ensureLoaded() async {
    if (!_loaded) {
      _todos = await _storage.loadTodos();
      _loaded = true;
    }
  }
}
```

**Commenting Policy:**
- ✅ Comment only when code does something **tricky or non-obvious**
- ✅ Comment complex algorithms, workarounds, or non-intuitive behavior
- ❌ Don't comment obvious code (e.g., "Creates a new instance" for constructors)
- ❌ Don't restate parameter names/types in comments
- ❌ Don't comment what the code already clearly shows
- Let code be self-documenting through clear naming

---

## 5. File Creation Rules

### Before Creating Files

1. **Check** if similar functionality exists
2. **Confirm** the file location follows the directory structure
3. **Verify** dependencies point inward (domain → infrastructure)

### File Naming

- **Entities**: `{name}_entity.{ext}`
- **Use Cases**: `{action}_{entity}_use_case.{ext}`
- **Repositories**: `{entity}_repository.{ext}` (interface), `{entity}_repository_impl.{ext}` (implementation)
- **Screens**: `{name}_screen.{ext}`
- **Widgets**: `{name}_widget.{ext}`

---

## 6. Testing Requirements

### Minimum Coverage

- **Domain**: 100% (all entities, value objects, domain services)
- **Application**: 80% (use cases, mappers)
- **Infrastructure**: 70% (adapters, repositories)
- **Presentation**: 60% (screens, widgets)

### Test Structure

```
tests/
├── unit/
│   ├── domain/
│   ├── application/
│   └── infrastructure/
├── integration/
│   └── infrastructure/
└── e2e/
    └── presentation/
```

---

## 7. Code Review Checklist

Before marking code as complete, verify:

- [ ] Follows Hexagonal Architecture (dependency rule)
- [ ] All public APIs documented
- [ ] No hardcoded strings/URLs
- [ ] Error handling implemented
- [ ] Tests written and passing
- [ ] No business logic in UI
- [ ] Follows platform-specific conventions

---

## 8. Platform-Specific Guidelines

### Flutter

- Use `const` constructors where possible
- Prefer `final` over `var`
- Use `late` only when necessary
- Follow Flutter lint rules

### React Native / React

- Use functional components with hooks
- Prefer TypeScript over JavaScript
- Use `useMemo` and `useCallback` appropriately
- Follow ESLint rules

### Node.js / Firebase Functions

- Use async/await (avoid callbacks)
- Validate all inputs
- Handle errors gracefully
- Use environment variables for config

### Spring Boot

- Use dependency injection
- Follow RESTful conventions
- Validate request bodies
- Use DTOs for API responses

---

## 9. Git Commit Messages

### Format

```
<type>(<scope>): <subject>

<body>

<footer>
```

### Types

- `feat`: New feature
- `fix`: Bug fix
- `docs`: Documentation
- `refactor`: Code refactoring
- `test`: Tests
- `chore`: Maintenance

### Example

```
feat(core): add create todo use case

Implements the CreateTodoUseCase following Hexagonal Architecture.
The use case validates input and delegates to TodoRepository.

Closes #123
```

---

## 10. When in Doubt

1. **Ask the user** for clarification
2. **Refer to** `project_constitution.md`
3. **Check** existing code patterns
4. **Propose** a solution and wait for approval

---

**End of Rules**
